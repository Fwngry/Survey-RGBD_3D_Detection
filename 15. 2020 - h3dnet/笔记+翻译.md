pipeline：

1. pred：BB center、BB face center、BB edge center
2. geo primitive ➡️ 距离函数 dist(obj, geo primitive) ➡️ proposal
3. proposal - 分类+调整

端到端的

相关阅读：H3DNet与[28]最为相关，它利用深度神经网络来预测物体的边界盒。H3DNet的关键创新之处在于，它利用了一套超完整的几何基元和一个距离函数来整合它们进行物体检测。

open source：https://github.com/zaiweizhang/H3DNet

## 摘要

我们介绍了H3DNet，它将三维点云作为输入，并输出一个面向对象的边界框（或BB）及其语义标签的集合。

1. H3DNet的关键思想是预测一组混合的几何基元，即**BB中心、BB面中心和BB边缘中心**。
2. **我们展示了如何通过定义物体obj和几何基元GEO primitive 之间的距离函数，将预测的几何基元转换成物体建议。**这个距离函数可以对物体建议进行连续优化，其局部最小值可以提供高清晰度的物体建议。
3. H3DNet利用匹配和重构模块，将物体建议**分类**为检测到的物体，并对检测到的物体的几何参数进行微调。

与使用单一类型的几何基元相比，**混合几何基元集不仅为物体检测提供了更准确的信号，而且还为所产生的三维布局提供了一套超完整的约束。**因此，H3DNet可以容忍预测的几何基元中的异常值。我们的模型在两个具有真实三维扫描的大型数据集上实现了最先进的三维检测结果，即ScanNet和SUN RGB-D。

![image-20210619174816388](https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_19_06_19_image-20210619174816388.png)

H3DNet由三个模块组成：

1. GEO primitive module：第一个模块计算密集描述符并预测三个几何基元，即BB中心、BB面中心和BB边缘中心。
2. 提议生成 module：第二个模块将几何基元转换为物体建议。
3. 分类&调整 module：第三个模块对对物体建议进行分类，并对检测到的对象进行重新定义。

1. pred：BB center、BB face center、BB edge center
2. geo primitive ➡️ 距离函数 dist(obj, geo primitive) ➡️ proposal
3. proposal - 分类+调整

## 引言

物体检测是视觉识别中的一个基本问题。在这项工作中，我们旨在从**点云中检测三维布局**（即面向三维边界框（或BBs）和相关的语义标签）。由于不规则的输入和不同场景中不同数量的物体，这个问题从根本上说是具有挑战性的。

**选择合适的中间表征，将低层次的物体线索整合到检测到的物体中，是决定结果系统性能的关键。**虽然早期的工作[38, 39]将滑动窗口分类用于物体检测，但最近的工作[32, 4, 16, 29, 54, 28, 51, 35, 51, 27, 45]显示了设计端到端神经网络来生成、分类和重新定义物体建议的巨大前景。

**本文介绍了H3DNet，这是一个端到端的神经网络，利用一种新型的中间表征进行三维物体检测。具体来说，H3DNet首先预测一套混合的、超完整的几何基元（即BB中心、BB面中心和BB边缘中心），然后检测物体以满足这些基元及其相关特征。**

这种回归方法源于最近<u>基于关键点的姿势回归在6D物体姿势估计方面的成功[19, 25, 11, 21, 26, 36]</u>，在3D物体检测方面显示出两个有吸引力的优势。

**几何基元设计思想**

首先，**[每种类型的几何基元]都对应于[输入点云的不同区域]**（例如，整个物体的点用于预测BB中心，平面边界表面的点用于预测相应的BB面中心）。

1. 不同基元，提高泛化能力：结合不同的基元类型可以增加其**泛化行为的优势**。在新的实例上，它们比仅仅使用一种类型的基元提供了更多有用的约束和特征。
2. 容忍异常值：拥有一个超完整的基元约束集可以**容忍预测基元中的异常值**（例如，使用鲁棒函数），并减少个别预测错误的影响。

**H3DNet由三个模块组成**

1. （预测 geo primitive）第一个模块计算密集的点状描述符，并使用它们来预测几何基元及其潜在特征。

2. （距离函数 - 生成建议）第二个模块将这些几何基元转换为物体建议。

H3DNet的一个关键创新是确定一个参数化的距离函数，以评估物体BB和预测基元之间的距离。这个距离函数可以很容易地纳入不同的和不完整的几何基元。它的局部最小值自然对应于物体的建议。这种方法使我们能够不断优化对象BB，并从不精确的初始提议中生成高质量的对象提议。

3. （标签+微调）H3DNet的最后一个模块将每个物体建议分类为是否为检测到的物体，并为每个检测到的物体预测其几何参数的集合向量和语义标签，以便对检测结果进行微调。这<u>个模块的性能取决于输入。</u>由于每个物体的提议都与不同的几何基元相关，H3DNet聚集了与这些基元相关的潜在特征，这些特征可能包含互补的语义和几何信息，作为该模块的输入。

我们还引入了一种网络设计，可以处理不同数量的几何基元。

我们在两个流行的基准数据集ScanNet和SUN RGB-D上评估了H3DNet。在ScanNet上，H3DNet的mAP（0.25）达到了67.2%，与仅将三维点位置作为输入的最先进方法相比，有8.5%的相对改进。在SUN RGB-D上，H3DNet的mAP（0.25）达到了60.1%，与同一组最先进的方法相比，有2.4%的相对改善。

困难类别：在这两个数据集的困难类别上（即那些具有低mAP分数的类别），H3DNet的性能提升是显著的（例如，在窗户/门/淋浴帘上，分别从38.1/47.3/57.1到51.9/61.0/75.3/）。

消融实验：我们还对H3DNet进行了消融研究：实验结果证明了对混合和超完整的几何基元集进行**回归以生成物体建议**的重要性，以及**聚合与匹配（基元相关的）特征**以对检测到的物体进行<u>分类和调整</u>的重要性。综上所述，我们的工作的贡献是：

- 问题描述：将物体检测表述为**回归和聚合一个超完整的几何基元集**
- 不同场景和类型：预测适合**不同物体类型和场景**的多种类型的几何基元
- 只有点云：在只有点云的SUN RGB-D和ScanNet上获得最先进的结果

## 相关工作

### 三维物体检测

从方法论的角度来看，三维物体检测方法与二维物体检测方法之间存在着紧密的联系。大多数现有的工作都遵循对使用滑动窗口[38, 39]或更先进的技术[29, 54, 28, 51, 35, 51, 27, 45]生成的候选对象进行分类的方法。对象分类涉及基于模板的方法或深度神经网络。

二维方法和三维方法之间的关键区别在于特征表示。例如，

[23]利用一对语义背景的潜力来指导提案的对象性得分。

[32]使用定向梯度云（COG）进行物体检测。

3d-sis: 3d semantic instance segmentation of rgbd scans.[9]**利用三维卷积神经网络来识别三维物体的位置和关键点。**

由于3D领域的计算成本，许多方法利用2D-3D投影技术来整合2D物体检测和3D数据处理。例如，MV3D[4]和VoxelNet[54]在进入其余管道之前，以鸟瞰图表示三维输入数据。

[13, 16, 29]首先处理二维输入，以确定候选的三维物体建议。

点云已经成为三维深度学习的一个强有力的表示，特别是在提取突出的几何特征和空间位置方面（参见[30, 31]）。先前使用的基于点的神经网络包括分类[30, 31, 20, 44, 15, 48, 46, 47, 8, 10]，分割[31, 40, 2, 20, 44, 42, 15, 48, 46, 47, 8, 10, 7, 45]，正常估计[2]和三维重建[41, 6, 49]。

人们对点云的物体检测也越来越感兴趣[28, 51, 35, 51, 27, 45]。H3DNet与[28]最为相关，它利用深度神经网络来预测物体的边界盒。H3DNet的关键创新之处在于，它利用了一套超完整的几何基元和一个距离函数来整合它们进行物体检测。

### Primitive Module

几何基元可以为一个BB提供多达19个位置约束。正如我们将在后面看到的，它们在生成、分类和重新确定对象建议方面具有很大的灵活性。

该模块的设计结合了描述符子模块和预测子模块。描述符子模块计算密集的点状描述符。其输出被送入预测子模块，该模块由三个预测分支组成。每个分支预测一种类型的几何基元。下面我们提供网络设计的技术细节。

 **A. 描述符子模块**

1. 描述符子模块的输出提供了**语义信息**，用于对预测几何基元的点**进行分组**（例如，同一物体的点用于BB中心，同一平面边界面的点用于BB面中心）；
2. H3DNet没有使用单一的描述符计算塔[29]，而是整合了**四个独立的描述符计算塔**。由此产生的描述符被串联起来，用于H3DNet的原始预测和后续模块。

**B1. BB中心预测**

H3DNet利用三个全连接层的网络来预测每个点和其对应的物体中心之间的oﬀset。所得的BB中心是通过聚类得到的。除了oﬀset，H3DNet还为每个BB中心计算相关的特征描述符。这些特征描述符可作为H3DNet后续模块的输入特征表示。

对完整和矩形物体的BB中心的预测是准确的。对于部分和/或遮挡的物体，以及薄的物体，如图片或窗帘，由于oﬀ集预测的不平衡加权，会出现移位错误。这促使我们考虑BB面和BB边的中心。

**B2. BB face 中心预测**

H3DNet使用3个全连接层来进行点的预测。预测的属性包括一个标志，表示一个点是否接近BB面，如果是，则表示该点和其相应的BB面中心之间的一个集合向量。在训练中，我们通过计算每个点的最接近的BB面来生成地面真实标签。如果这个距离小于0.2米，我们就说一个点靠近BB脸（即一个积极的实例）。与BB中心类似，每个BB脸中心预测也拥有一个潜在的特征描述符，并被输入到后续模块中。

由于face中心预测只由接近该face的点来决定，我们发现它们对具有丰富平面斑块的物体（如冰箱和浴帘）和不完整的物体特别有用。

**B3. BB边缘中心预测**

边界线特征构成了所有三维场景和物体中的另一种几何线索。与BB face 类似，H3DNet采用了3个全连接层来预测每个点的flag，表明它是否接近BB边缘，如果是，则是该点与相应的BB边缘中心之间的oﬀset。与BB面中心一样，我们通过计算每个点的最接近的BB边来生成地面真实标签。如果最接近的距离小于0.2米，我们就说一个点靠近BB边缘。同样，每个BB边缘中心的预测都拥有相同维度的潜在特征。与BB中心和BB面中心相比，BB边缘中心对于点密度不规则（如有大洞）但BB边缘看起来很完整（如窗户和电脑桌）的物体很有用。

不同基元的误差分布在很大程度上是相互不相关的。这种不相关的预测误差为将它们整合在一起检测物体时的性能提升打下了基础。

### Proposal Module

**A. Proposal 距离函数**

obj proposal（19 x {l0,c0,s0,n0} - o）：需要初始化，作为函数的输入，在函数中得到优化

& geo prim（predicted - pi）：由第一个module生成，作为函数的既定参数

![image-20210620150026478](https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_20_06_20_image-20210620150026478.png)

![image-20210620150101118](https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_20_06_20_image-20210620150101118.png)

H3DNet通过从一组初始方案中探索距离函数的局部最小值来检测物体建议。从优化的角度来看，我们从任何与该局部最小值非常接近的初始方案中获得相同的局部最小值。这意味着初始方案不需要是精确的。在我们的实验中，我们发现一个简单的对象建议生成方法是非常有效的。具体而言，H3DNet采用了[29]的方法，从每个检测到的BB中心初始化一个物体建议。

**B. 初始化proposal**

H3DNet通过探索一组初始提议的距离函数的局部最小值来检测物体提议。从优化的角度来看，我们从任何与该局部最小值非常接近的初始方案中获得相同的局部最小值。**这意味着初始方案不需要是精确的**。在我们的实验中，我们发现一个简单的对象建议生成方法是非常有效的。具体来说，H3DNet采用了[29]的方法，从每个检测到的BB中心初始化一个物体建议。

**C. 调整proposal**

通过最小化FS，我们对每个初始提议进行重新定义。请注意，不同的初始建议可能共享相同的局部最小值。**最终的对象建议只收集独特的局部最小值。**

### Classiﬁcation and Reﬁnement Module

H3DNet的最后一个模块将提议模块的输出作为输入，并输出一个检测到的物体集合。这个模块结合了分类子模块和重构子模块。分类子模块决定每个提议的物体是否是一个物体。重构子模块为每个检测到的物体预测BB中心、BB大小、BB方向和语义标签中的Oﬀset。

**[思想：聚合相关特征]**

其主要思想是聚合与每个物体建议的基元（即物体中心、边缘中心和面中心）相关的特征。这些特征可以捕捉到潜在的互补信息，但只有在这个阶段（即在我们检测到匹配的基元组之后），才有可能将它们融合在一起，以确定和微调检测到的物体。

![image-20210620151945685](https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_20_06_20_image-20210620151945685.png)

如图3所示，我们通过组合四个全连接层来实现这个子模块。输入层将一个物体建议的19个物体基元（即一个BB中心、六个BB面中心和12个BB边缘中心）的输入特征连接起来。每个输入特征都**整合了与处于相应物体基元附近的基元相关的特征**。

为了解决**存在不同数量的邻域基元（例如，没有或多个）的问题**，我们利用PointNet[31,32]中的最大集合层的一个变体来计算输入特征：相关特征+随机采样32个点

具体来说，每个**maxpooling**层的输入= **与输入对象建议相关的特征**，它解决了没有匹配基元的问题，以及在每个对象基元的邻域随机采样的32个特征点。在我们的实现中，我们通过范围查询确定邻近的基元，半径为0.05米。

这个模块的输出结合了表示客观性的标签、BB中心的oﬀsets、BB大小和BB方向，以及一个语义标签。

## 实验

ScanNet V2 [5] 和SUN RGB-D V1 [38]

各类别，AP-0.25 

![image-20210620154047865](https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_20_image-20210620154047865.png)

所有类别，mAP-0.25/mAP-0.5

![image-20210601115916553](https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_01_06_01_image-20210601115916553.png)



**VoteNet、GSPN、3D-SIS、DSS、F-PointNet、2D-Driven、Cloud of gradient**

✅ VoteNet [28] is a geometric-only detector that combines deep point set networks and a voting procedure. 

✅GSPN[51] uses a generative model for instance segmentation. 

✅Both 3D-SIS [9] and DSS [39] extract features from 2D images and 3D shapes to generate object proposals. 

✅F-PointNet [29] and 2D-Driven [17] ﬁrst propose 2D detection regions and project them to 3D frustum for 3D detection. 

✅Cloud of gradient(COG) [32] integrates sliding windows with a 3D HoG-like feature.

### 结果分析

如表2所示，在3D IoU阈值为0.25（mAP@0.25）的情况下，我们的方法在ScanNet V2上的平均mAP得分为67.2%，比表现最好的基线方法[28]好8.5%。此外，我们的方法比3D IoU阈值为0.5的基线方法[28]好14.6%（mAP@0.5）。

对于SUN RGB-D，在3D IoU阈值为0.25和0.5时，我们的方法在mAP方面分别提高了2.4%和6.1%。在这两个数据集上，我们的方法在mAP@0.5 下的性能提升大于在mAP@0.25 下的性能提升，这意味着我们的方法比基线方法能提供更准确的预测结果。

这样的改进归功于使用了一套超完整的几何基元及其相关的特征来生成和重新确定物体建议。我们也可以用类似的方式来理解SUN RGB-D比ScanNet的相对不突出的改进，即前者的标签不如后者准确，**H3DNet的优势在SUN RGB-D上没有得到充分的利用**。除了分类和重构模块，我们的方法与VoteNet有着相似的计算管道和复杂性。多个描述符塔和建议模块的计算可以并行进行，这不应该增加计算开销。在我们的实现中，我们的方法每次扫描最后一个模块需要0.058秒。从概念上讲，与[28]votenet相比，我们的方法需要多50%的时间，但操作起来的检测精度更高。

1. 对<u>薄型物体</u>的改进

目前表现最好的基线[28]的一个限制是预测三维场景中的薄物体，如门、窗和图片。相比之下，通过脸部和边缘基元，H3DNet能够为那些薄的物体提取更好的特征。**例如，窗户或图片的框架提供了密集的边缘特征，窗帘或浴帘的物理纹理提供了密集的面/表面特征。**H3DNet在薄型物体上有明显的性能提升，如门（13.7%）、窗（13.8%）、图片（10.8%）、窗帘（10.1%）和浴帘（18.2%）。

2. 对具有密集的几何基元的物体的改进

在表1中ScanNet的各个物体类别中，除了那些薄的物体外，我们的方法还导致了对橱柜（13.1%）、桌子（6.1%）、书架（10.3%）、冰箱（11.8%）、水槽（12.7%）和其他家具（16.4%）的显著性能提升。一种解释是，**这些物体类别的几何形状具有丰富的平面结构和/或明显的边缘结构，这对几何基元检测和物体重构有很大贡献。**

3. **基元匹配和重构的效果**

使用距离函数来重新确定对象的建议，并聚合匹配基元的特征，这对H3DNet来说至关重要。

在ScanNet上，仅仅对最初的提议进行分类，就使mAP 0.5的结果下降了14.6%。图4显示了定性的物体检测结果，这再次证明了优化和重定物体建议的重要性。

### 消融实验

1. 不同的几何基元所产生的影响

H3DNet结合：BB中心、BB边缘中心和BB面中心，将它们的泛化行为的强度加在一起。

<img src="https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_01_image-20210601123129175.png" alt="image-20210601123129175" style="zoom: 33%;" />

2. 建议微调 proposal refinement的影响

在物体建议重构过程中，物体中心、尺寸、航向角、语义和存在性都得到了优化。如表3所示，如果不对检测到的物体的任何几何参数进行微调，性能就会下降，这说明这个子模块的重要性。

<img src="https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_01_image-20210601122913909.png" alt="image-20210601122913909" style="zoom: 33%;" />

3. 不同截断阈值的影响

在不同的截断值δ下，mAP@0.25 和mAP@0.5 的结果保持稳定。这表明，我们的模型对不同的截断阈值δ是稳健的。

4. <u>多描述符计算塔 multiple descriptor computation towers</u> 的影响

H3DNet的一个超参数是描述符计算塔的数量。表4显示，添加更多的描述符计算塔会带来更好的结果，然而添加更多的描述符计算塔的性能增益很快就会下降。此外，H3DNet相对于VoteNet的性能增益来自于几何基元和物体提议匹配与重构的<u>混合集 hybrid set</u> of geometric primitives and object proposal matching and reﬁnement。例如，用H3DNet的四个描述符计算塔取代VoteNet的描述符计算塔，

在ScanNet和SUN RGB-D上分别只产生了少量的和没有的性能增益（见表4）

<img src="https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_01_image-20210601142309190.png" alt="image-20210601142309190" style="zoom: 33%;" />

## 结论和未来工作

在本文中，我们介绍了一种新型的三维物体检测方法，该方法将三维场景作为输入，并输出一组有标签和有方向的边界框。我们的方法的关键思想是预测一个混合和超完整的几何基元集，然后将检测到的物体与这些基元及其相关的特征相匹配。实验结果证明了这种方法在ScanNet和SUN RGB-D上的优势。在未来，我们希望将这种方法应用于<u>其他三维场景理解任务</u>，如实例分割和CAD模型重建。另一个未来的方向是整合<u>更多的几何基元</u>，如BB角，用于3D物体检测。

