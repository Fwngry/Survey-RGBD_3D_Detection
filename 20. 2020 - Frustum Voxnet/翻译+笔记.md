# Frustum Voxnet

> 主要设计：使用2DCNN确定Frustum，进一步确定哪些是感兴趣的区域，通过体素化提供高分辨率表示。输入到3D CNN中。
>
> 部分体素化，对Frustum按照（FRxFC）分割为subFrustum，3DCB，根据IOI和Recall指标（这些3D指标可以通过2D指标算得），得到最佳的3DCB
>
> 双Frustum方法：小Frustum用于预测3DCB中心，大Frustum用于生成3DCB
>
> 多尺度网络：四种规模类别的网络用于体素化
>
> 实验
>
> 1. 流水线技术提高效率、GN、BN、Dropout
> 2. 文章提供了2D proposal 检测器部分的横向对比；
> 3. 更换2D 检测器 FPN为YOLO v3，可以提高实时性，降低参数量，但准确率有所下降
>
> 优势：减少了内存需求，我们的系统基于一个小型网络，可以每秒处理20帧，检测结果与最先进的[16]相当，实现了2倍的速度提升。
>
> 后续阅读：基于ResNet的高效三维全卷积网络（FCN）

## 摘要

最近，有大量来自RGB以及3D图像的分类和检测系统。在这项工作中，我们描述了一个来自RGB-D或纯深度点云的新的3D物体检测系统。

我们的系统首先检测二维的物体（无论是RGB，还是从深度构建的伪RGB）。

下一步是在这些二维检测所确定的三维区域内检测三维物体。这是通过对部分Frustum进行体素化来实现的（因为Frustum可能非常大），而不是像早期工作那样使用整个Frustum。**我们系统的主要创新之处在于确定哪些部分（三维建议）的Frustum要被体素化，从而使我们能够在感兴趣的对象周围提供高分辨率的表示。**这也使我们的系统减少了内存需求。

这些三维建议被送入一个基于ResNet的高效三维全卷积网络（FCN）。我们的三维检测系统是快速的，并且可以集成到机器人平台上。

对于不进行体素化的系统（如PointNet），我们的方法可以在不要求对数据集进行子采样的情况下运行。我们还引入了一种流水线方法，进一步提高了我们系统的效率。**SUN RGB-D数据集的结果显示，我们的系统基于一个小型网络，可以每秒处理20帧，检测结果与最先进的[16]相当，实现了2倍的速度提升。**

## 引言

二维检测器可以在输入的RGB图像或由三维点云生成的pseuso-RGB图像上运行。该二维检测产生一个三维Frustum（由传感器和二维检测的边界框定义），在那里进行三维物体的搜索。我们的主要贡献是在这样的Frustum内进行三维物体检测。**我们的方法涉及3D体素化，不是整个Frustum，而是其中的一个学习部分。这允许更高分辨率的体素化，更低的内存要求，以及更有效的检测。**

图1说明了我们系统的概况

在左上角，我们看到一个二维的RGB图像，以及检测到的二维边界框（一张椅子和一张桌子）。在右上角，我们看到一张二维伪RGB图像，它是由相关的三维范围图像生成的（见[28]），以及类似的检测到的二维有界方框。我们把这个伪RGB图像称为DHS图像，其中D代表深度，H代表高度，S代表标志角度。深度是相关三维点的归一化距离，高度是三维点的归一化高度，而有符号的角度是三维点的归一化法线近似值（见[28]）。我们可以在这个伪RGB图像上应用传统的2D检测器，使我们的方法在没有RGB信息的情况下也能适用。然后从这些二维检测中提取三维Frustum。三维Frustum是一个以传感器位置为顶点的棱镜，并通过二维边界框延伸到三维空间。三维Frustum的学习部分正在被体素化。这些体素化被送入Frustum VoxNet，它是一个三维全卷积神经网络（FCN）。

我们工作的主要贡献可以概括为以下几点。

- 我们证明了使用基于体积数据的三维FCN方法能够有效地实现准确的三维检测结果。

- 我们提供了一种新的方法来学习三维空间的体素化部分。这使我们能够在感兴趣的物体周围提供高分辨率的表示。这也使我们的系统减少了对内存的需求，从而提高了系统的效率。

- 与不进行体素化的系统相比（如[17, 16]），我们的方法可以在不需要对数据集进行子采样的情况下运行。

- 与进行体素化的系统相比（如[29]），我们的系统不对整个空间进行体素化，因此可以获得更高分辨率的物体表示。

- 我们的网络参数要比领先的方法小得多。这导致了**更快**的推理时间。

## 相关工作

**二维方法**

基于RGB的方法可以归纳为两阶段框架（提议和检测阶段）和单阶段框架（提议和检测并行）。一般来说，两阶段方法如R-CNN[4]、Fast RCNN[3]、Faster RCNN[20]、FPN[11]和mask R-CNN[6]可以实现更好的检测性能，而单阶段系统如YOLO[18]、YOLO9000[19]和RetinaNet[12]则以降低精度为代价，速度更快。对于基于深度学习的系统，随着网络规模的增加，需要更大的数据集。标签数据集，如PASCAL VOC数据集[2]和COCO（Common Objects in Context）[13]在二维检测系统的持续改进中发挥了重要作用。

三维方法

与基于二维图像的检测相比，基于三维数据的检测更具挑战性，原因有以下几点[22]：

1）数据表示本身更加复杂。三维图像可以用点云、网格或体积表示，而二维图像有像素网格表示。

2）由于额外的维度，对计算和内存资源的要求增加。

3）与密集的二维图像相比，三维数据通常比较稀疏，分辨率较低，因此三维物体更难识别。最后，

4）大尺寸的标记数据集对基于监督的算法极为重要，但与精心构建的二维数据集相比，仍然逊色。下面我们总结一下这些基本方法。

**将三维数据投影到二维**

HHA编码[5]

DHS编码[28]

**从RGB-D数据中进行2D驱动的3D物体检测** 

我们提出的框架主要受2D驱动的3D物体检测方法的启发，如[10, 16]。首先，一个二维检测器被用来生成二维检测结果。我们的工作与[10]的不同之处在于:

1）[10]中的2D检测器<u>只基于RGB图像</u>，而我们提出的系统探索RGB-D和Depth only。

2）[10]中的三维检测使用MLP回归器，根据沿x、y和z方向的点的<u>直方图来回归物体的边界</u>。将原始点云转换为直方图会造成信息的损失。

我们的系统与Frustum PointNets[16]的主要区别如下:

1）在二维检测部分，Frustum PointNets是基于RGB输入的，而我们的系统可以支持RGB-D和纯深度感应。

2）在三维检测部分，我们的系统使用体素化数据，而Frustum PointNets通过PointNet[17]消耗原始点云。**PointNet使用全连接的神经网络和最大池，所以它不能很好地支持卷积/解卷积操作。我们相信三维卷积/解卷积在三维语义分割和物体检测中都能发挥重要作用。**

3）如果有更多的点，PointNet的计算复杂性会增加，因为该框架的输入是N×K，其中N是点的数量，K是通道的数量。

4) PointNet中需要随机抽样，但在我们的体素化方法中不需要。

最近一种基于PointNet和Hough Voting的方法[15]，在不使用RGB图像的情况下取得了更好的检测结果。**我们的方法在推理时间上仍然更有效率，因此更适合于机器人应用。**另外，我们的方法不需要像[15]那样对三维点云进行子采样。

**三维CNN** 

VoxelNet[29]使用三维LiDAR数据来检测基于KITTI户外数据集的三维物体，并利用鸟瞰图（BEV）特征（如MV3D[1]和AVOD[9]））。

在室内应用中，使用BEV是没有帮助的。另外，使用整个范围的图像进行体素化，降低了感兴趣物体的分辨率（因此也降低了规模）。

早期有影响力的三维检测系统使用两阶段方法。第一阶段产生建议，第二阶段进行三维检测。DeepSliding Shape[24]基于SUNRGB-D数据集检测3D物体，它使用定向截断符号距离函数（TSDF）来编码3D形状。三维空间被划分为三维体素，每个体素的值被定义为体素中心与输入深度图的表面之间的最短距离。一个完全卷积的三维网络在两个尺度上提取三维建议，对应于大尺寸物体和小尺寸物体。

对于最终的3D检测，该方法通过使用3D和2D CNN将3D体素数据和RGB图像数据融合在一起。另一方面，我们的方法首先关注要体素化的Frustum，然后根据训练选择要体素化的部分。这使我们能够在感兴趣的物体周围获得更高的分辨率。

## Frustum Voxelization

部分体素化，对Frustum按照（FRxFC）分割为subFrustum，3DCB，根据IOI和Recall指标（这些3D指标可以通过2D指标算得），得到最佳的3DCB

双Frustum方法：小Frustum用于预测3DCB中心，大Frustum用于生成3DCB

多尺度网络：四种规模类别的网络用于体素化

## 5. 训练

二维检测：我们使用ResNet[7]101层作为backbone，并使用[11]提出的特征金字塔层（基于Faster RCNN[20]方法），损失与[11]相同。对于二维检测，该网络在COCO数据集上进行了预训练。然后在基于RGB或DHS图像的SUN-RGBD数据集上重新训练。尽管DHS图像与RGB图像不同，但我们发现预训练的权重仍然可以加快整个训练过程，并提高检测结果。通过增加高斯模糊；随机裁剪和图像翻译，数据被增加到原始图像的10%。

三维检测：我们使用随机梯度下降法（SGD），学习率为0.01，预定衰减为0.00001。对于调节，我们使用批量归一化[8]。在将云点送入网络之前，云点围绕Z轴随机旋转并在体素化过程中进行抖动。

## 6.流水线技术提高效率

流水线指令是中央处理单元中用来加快计算速度的技术。一个指令流水线从存储器中读取一条指令，而之前的指令正在流水线的其他步骤中执行。因此，多条指令可以同时执行。在我们的系统中可以完美地使用流水线，因为我们有两个阶段，一个是2D检测，一个是3D检测。在3D检测中，我们可以使用第n帧的2D检测，而不是使用第n-1帧的2D检测结果，并在此基础上生成frustum。通过使用流水线，我们的系统可以从t 2D + t 3D加速到max(t 2D , t 3D )，其中t 2D和t 3D分别是2D和3D检测时间。使用流水线的缺点是，在感兴趣的物体的传感器快速移动的情况下，由先前的二维图像产生的Frustum可能不准确。通过使用流水线，当使用YOLO v3和ResNetFCN6时，我们的系统可以加快到48ms（这大约是最先进的2.5倍的速度[16]）。它可以达到每秒21帧的速度，可以很好地支持实时的三维物体检测。

### 7.1. GN[8]、BN[27]和Dropout[25]的影响

- Dropout是防止神经网络过量的一个有力工具。

- 批量归一化（BN）[8]是另一种方法，我们可以用它来加快训练速度并防止过度疲劳。当批量大小足够大时，BN的表现更好。由于Frustum VoxNet使用的是三维CNN，因此在使用单GPU时，大批量的支持并不充分。
- 一些新的技术被引入以解决小批量的问题，如Group Normalization(GN) [27]。

我们通过评估中心和方向预测的性能来探索这些方法的不同组合的性能。结果显示在图8中。我们没有使用BN，因为我们的批处理量很小，而且使用BN会导致训练和推理之间的不一致。虽然在使用GN时，训练和推理之间没有不一致的地方，但与不使用任何规范化相比，中心预测的性能更差。

**因此，我们的最终模型不使用任何规范化。然而，在我们的最终模型中，由于中心预测的性能得到了改善，所以使用了dropout。**

### 7.2. 对整个系统的评价

首先，我们对表3中的**2D检测器进行评估**。该评估是基于标准的mAP指标，IoU阈值为0.5。比较我们基于RGB和基于深度（DHS图像）的2D检测，我们看到在大多数情况下，RGB表现更好，但基于深度的2D检测器是有竞争力的。

![image-20210619143318170](https://oj84-1259326782.cos.ap-chengdu.myqcloud.com/uPic/2021/06_19_06_19_image-20210619143318170.png)

对于少数类别，如浴缸，DHS的结果略好。原因可能是一些类别，如浴缸有特殊的几何形状，它们更容易被深度传感器检测到。与最先进的方法相比，我们的二维检测器在某些类别中表现得更好，而且我们也在引入新的类别。除了浴缸、书桌和书架之外，我们在大多数其他类别中的表现都是一样的。

完整的三维检测结果显示在表4中。我们在系统中提供了各种变化。前两种变化包括RGB 2D检测器，后两种变化包括仅有深度（DHS）的2D检测器。在所有情况下，我们都使用FPN作为2D检测器。对于三维检测，我们用ResNetFCN6和ResNetFCN35进行了实验。与二维情况一样，我们的三维检测器在大多数类别中与最先进的检测器持平，而且我们还纳入了更多的类别。仅从三维检测器的计算性能来看，我们发现我们使用ResNetFCN6的实现在推理时间上有很大的改进。由于该架构是模块化的（也就是说，我们可以将我们的二维检测器换成报告中最先进的一个）我们看到，我们的方法可以导致显著的效率提高，而检测精度没有明显下降。这将导致一个面向实时机器人应用的系统的诞生。

我们还评估了我们的系统在使用非常快速的2D检测器（Yolo v3）时的效率和准确性。表5显示了检测精度的下降，这是预料之中的。

最后，表6详细分析了多个网络组合的效率，以及需要调整的参数数量。如前所述，我们可以在三维检测中实现更快的推理时间，**因此，如果我们将我们的二维检测器与报告中的最先进的检测器进行交换，可以导致整个系统更快。**使用Yolo和流水线方法，我们可以在总效率上有明显的提升，但准确性会有损失。

我们通过使用2D/3D CNN提出了一个基于2D的3D检测系统。我们的方法可以在只有深度和RGB-D传感器模式下运行。我们提供了与最先进水平相当的结果，但3D检测的效率明显提高。这是由于我们使用了比竞争者更少参数的网络。

这也是由于我们能够只对三维Frustum的一部分进行体素化。这导致了内存需求的减少和感兴趣的物体周围分辨率的提高。

在未来的工作中，我们将整合分割，我们相信这将进一步提高我们系统的检测精度。

## 结论

我们通过使用2D/3D CNN提出了一个基于2D的3D检测系统。我们的方法可以在只有深度和RGB-D传感器模式下运行。我们提供了与最先进水平相当的结果，但3D检测的效率明显提高。这是由于我们使用了比竞争者更少参数的网络。这也是由于我们能够只对三维Frustum的一部分进行体素化。这导致了内存需求的减少和感兴趣的物体周围分辨率的提高。在未来的工作中，我们将整合分割，我们相信这将进一步提高我们系统的检测精度。

